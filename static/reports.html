<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุงูุชูุงุฑูุฑ - ูุธุงู ุงููุญุงุณุจุฉ ููุฅูุชุงุฌ ุงูููู</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-100">
    <div class="flex h-screen overflow-hidden">
        <!-- Sidebar for desktop -->
        <div class="sidebar w-64 text-white hidden md:block">
            <div class="p-4">
                <div class="flex items-center justify-center mb-8">
                    <div class="w-10 h-10 bg-red-600 rounded-full flex items-center justify-center">
                        <i class="fas fa-film text-white"></i>
                    </div>
                </div>
                <div class="mb-10 text-center">
                    <div class="h-16 w-16 mx-auto rounded-full border-2 border-white mb-2 bg-gray-600 flex items-center justify-center">
                        <i class="fas fa-user text-white text-xl"></i>
                    </div>
                    <h4 class="font-bold" id="currentUserName">ุงููุณุชุฎุฏู</h4>
                    <p class="text-xs text-gray-300" id="currentUserRole">ุงูุฏูุฑ</p>
                </div>
                <nav>
                    <div class="mb-4">
                        <h5 class="text-sm uppercase text-gray-400 mb-2 px-4">ุงููุงุฆูุฉ ุงูุฑุฆูุณูุฉ</h5>
                        <a href="/dashboard.html" class="block py-2 px-4 rounded-lg hover:bg-gray-800 text-gray-300 mb-1">
                            <i class="fas fa-chart-line mr-2"></i> ููุญุฉ ุงูุชุญูู
                        </a>
                        <a href="/projects.html" class="block py-2 px-4 rounded-lg hover:bg-gray-800 text-gray-300 mb-1">
                            <i class="fas fa-film mr-2"></i> ุงููุดุงุฑูุน
                        </a>
                        <a href="/payroll.html" class="block py-2 px-4 rounded-lg hover:bg-gray-800 text-gray-300 mb-1">
                            <i class="fas fa-money-bill-wave mr-2"></i> ุงูุฑูุงุชุจ ูุงููุตุฑููุงุช
                        </a>
                        <a href="/transactions.html" class="block py-2 px-4 rounded-lg hover:bg-gray-800 text-gray-300 mb-1">
                            <i class="fas fa-dollar-sign mr-2"></i> ุงููุนุงููุงุช
                        </a>
                        <a href="/reports.html" class="block py-2 px-4 rounded-lg bg-gray-800 text-white mb-1">
                            <i class="fas fa-chart-pie mr-2"></i> ุงูุชูุงุฑูุฑ
                        </a>
                    </div>
                    <div class="mb-4" id="adminSection" style="display: none;">
                        <h5 class="text-sm uppercase text-gray-400 mb-2 px-4">ุงูุฅุฏุงุฑุฉ</h5>
                        <a href="/users.html" class="block py-2 px-4 rounded-lg hover:bg-gray-800 text-gray-300 mb-1">
                            <i class="fas fa-users mr-2"></i> ุงููุณุชุฎุฏููู
                        </a>
                        <a href="/settings.html" class="block py-2 px-4 rounded-lg hover:bg-gray-800 text-gray-300 mb-1">
                            <i class="fas fa-cog mr-2"></i> ุงูุฅุนุฏุงุฏุงุช
                        </a>
                    </div>
                </nav>
            </div>
        </div>

        <!-- Mobile menu overlay -->
        <div id="mobileMenu" class="fixed inset-0 z-50 md:hidden hidden">
            <div class="fixed inset-0 bg-black bg-opacity-50" id="mobileMenuOverlay"></div>
            <div class="fixed right-0 top-0 h-full w-64 bg-gray-800 text-white transform transition-transform duration-300 ease-in-out">
                <div class="p-4">
                    <div class="flex justify-between items-center mb-8">
                        <div class="w-10 h-10 bg-red-600 rounded-full flex items-center justify-center">
                            <i class="fas fa-film text-white"></i>
                        </div>
                        <button id="closeMobileMenu" class="text-white hover:text-gray-300">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    <div class="mb-10 text-center">
                        <div class="h-16 w-16 mx-auto rounded-full border-2 border-white mb-2 bg-gray-600 flex items-center justify-center">
                            <i class="fas fa-user text-white text-xl"></i>
                        </div>
                        <h4 class="font-bold" id="mobileCurrentUserName">ุงููุณุชุฎุฏู</h4>
                        <p class="text-xs text-gray-300" id="mobileCurrentUserRole">ุงูุฏูุฑ</p>
                    </div>
                    <nav>
                        <div class="mb-4">
                            <h5 class="text-sm uppercase text-gray-400 mb-2 px-4">ุงููุงุฆูุฉ ุงูุฑุฆูุณูุฉ</h5>
                            <a href="/dashboard.html" class="block py-2 px-4 rounded-lg hover:bg-gray-700 text-gray-300 mb-1">
                                <i class="fas fa-chart-line mr-2"></i> ููุญุฉ ุงูุชุญูู
                            </a>
                            <a href="/projects.html" class="block py-2 px-4 rounded-lg hover:bg-gray-700 text-gray-300 mb-1">
                                <i class="fas fa-film mr-2"></i> ุงููุดุงุฑูุน
                            </a>
                            <a href="/payroll.html" class="block py-2 px-4 rounded-lg hover:bg-gray-700 text-gray-300 mb-1">
                                <i class="fas fa-money-bill-wave mr-2"></i> ุงูุฑูุงุชุจ ูุงููุตุฑููุงุช
                            </a>
                            <a href="/transactions.html" class="block py-2 px-4 rounded-lg hover:bg-gray-700 text-gray-300 mb-1">
                                <i class="fas fa-dollar-sign mr-2"></i> ุงููุนุงููุงุช
                            </a>
                            <a href="/reports.html" class="block py-2 px-4 rounded-lg bg-gray-700 text-white mb-1">
                                <i class="fas fa-chart-pie mr-2"></i> ุงูุชูุงุฑูุฑ
                            </a>
                        </div>
                        <div class="mb-4" id="mobileAdminSection" style="display: none;">
                            <h5 class="text-sm uppercase text-gray-400 mb-2 px-4">ุงูุฅุฏุงุฑุฉ</h5>
                            <a href="/users.html" class="block py-2 px-4 rounded-lg hover:bg-gray-700 text-gray-300 mb-1">
                                <i class="fas fa-users mr-2"></i> ุงููุณุชุฎุฏููู
                            </a>
                            <a href="/settings.html" class="block py-2 px-4 rounded-lg hover:bg-gray-700 text-gray-300 mb-1">
                                <i class="fas fa-cog mr-2"></i> ุงูุฅุนุฏุงุฏุงุช
                            </a>
                        </div>
                    </nav>
                </div>
            </div>
        </div>

        <!-- Main content -->
        <div class="flex-1 flex flex-col overflow-hidden">
            <!-- Top header -->
            <header class="bg-white shadow-sm border-b border-gray-200 px-6 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <button id="mobileMenuButton" class="md:hidden mr-4 text-gray-600 hover:text-gray-900">
                            <i class="fas fa-bars text-xl"></i>
                        </button>
                        <h1 class="text-2xl font-bold text-gray-900">ุงูุชูุงุฑูุฑ ูุงูุชุญูููุงุช</h1>
                    </div>
                    <div class="flex items-center space-x-4 space-x-reverse">
                        <div class="relative">
                            <input type="text" placeholder="ุจุญุซ..." class="bg-gray-100 border border-gray-300 rounded-lg px-4 py-2 pr-10 focus:outline-none focus:ring-2 focus:ring-red-500" id="searchInput">
                            <i class="fas fa-search absolute right-3 top-3 text-gray-400"></i>
                        </div>
                        <div class="relative">
                            <button class="text-gray-600 hover:text-gray-900 relative">
                                <i class="fas fa-bell text-xl"></i>
                                <span class="absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">3</span>
                            </button>
                        </div>
                        <div class="relative">
                            <button id="userMenuButton" class="flex items-center space-x-2 space-x-reverse text-gray-700 hover:text-gray-900">
                                <div class="w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center">
                                    <i class="fas fa-user text-sm"></i>
                                </div>
                                <span id="headerUserName">admin</span>
                                <i class="fas fa-chevron-down text-sm"></i>
                            </button>
                            <div id="userDropdown" class="absolute left-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-50 hidden">
                                <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">ุงูููู ุงูุดุฎุตู</a>
                                <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">ุงูุฅุนุฏุงุฏุงุช</a>
                                <hr class="my-1">
                                <a href="#" onclick="logout()" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">ุชุณุฌูู ุงูุฎุฑูุฌ</a>
                            </div>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Page content -->
            <main class="flex-1 overflow-y-auto p-6">
                <div class="max-w-7xl mx-auto">
                    <!-- Report filters -->
                    <div class="dashboard-card p-6 mb-8">
                        <h2 class="text-xl font-bold text-gray-900 mb-6">ููุงุชุฑ ุงูุชูุงุฑูุฑ</h2>
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ุงููุดุฑูุน</label>
                                <select id="reportProject" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-red-500">
                                    <option value="">ุฌููุน ุงููุดุงุฑูุน</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ูู ุชุงุฑูุฎ</label>
                                <input type="date" id="startDate" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-red-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ุฅูู ุชุงุฑูุฎ</label>
                                <input type="date" id="endDate" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-red-500">
                            </div>
                            <div class="flex items-end">
                                <button onclick="generateReport()" class="btn-cinematic w-full px-4 py-2">
                                    <i class="fas fa-chart-bar mr-2"></i>
                                    ุฅูุดุงุก ุงูุชูุฑูุฑ
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Summary cards -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                        <div class="dashboard-card p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-gray-600">ุฅุฌูุงูู ุงูุฅูุฑุงุฏุงุช</p>
                                    <p class="text-2xl font-bold text-green-600" id="reportTotalRevenue">0 ุฌ.ู</p>
                                </div>
                                <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-arrow-up text-green-600 text-xl"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="dashboard-card p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-gray-600">ุฅุฌูุงูู ุงููุตุฑููุงุช</p>
                                    <p class="text-2xl font-bold text-red-600" id="reportTotalExpenses">0 ุฌ.ู</p>
                                </div>
                                <div class="w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-arrow-down text-red-600 text-xl"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="dashboard-card p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-gray-600">ุตุงูู ุงูุฑุจุญ</p>
                                    <p class="text-2xl font-bold text-blue-600" id="reportNetProfit">0 ุฌ.ู</p>
                                </div>
                                <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-chart-line text-blue-600 text-xl"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="dashboard-card p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-gray-600">ุนุฏุฏ ุงููุดุงุฑูุน</p>
                                    <p class="text-2xl font-bold text-purple-600" id="reportProjectCount">0</p>
                                </div>
                                <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-film text-purple-600 text-xl"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Charts -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                        <div class="dashboard-card p-6">
                            <h3 class="text-lg font-bold text-gray-900 mb-4">ุงูุฅูุฑุงุฏุงุช ูุงููุตุฑููุงุช ุงูุดูุฑูุฉ</h3>
                            <canvas id="monthlyChart" width="400" height="200"></canvas>
                        </div>
                        
                        <div class="dashboard-card p-6">
                            <h3 class="text-lg font-bold text-gray-900 mb-4">ุชูุฒูุน ุงููุตุฑููุงุช ุญุณุจ ุงููุฆุฉ</h3>
                            <canvas id="expenseChart" width="400" height="200"></canvas>
                        </div>
                    </div>

                    <!-- Project performance -->
                    <div class="dashboard-card p-6 mb-8">
                        <h3 class="text-lg font-bold text-gray-900 mb-6">ุฃุฏุงุก ุงููุดุงุฑูุน</h3>
                        <div class="overflow-x-auto">
                            <table class="w-full table-auto">
                                <thead>
                                    <tr class="bg-gray-50">
                                        <th class="px-4 py-3 text-right text-sm font-medium text-gray-700">ุงุณู ุงููุดุฑูุน</th>
                                        <th class="px-4 py-3 text-right text-sm font-medium text-gray-700">ุงูููุน</th>
                                        <th class="px-4 py-3 text-right text-sm font-medium text-gray-700">ุงูููุฒุงููุฉ</th>
                                        <th class="px-4 py-3 text-right text-sm font-medium text-gray-700">ุงููุตุฑูู</th>
                                        <th class="px-4 py-3 text-right text-sm font-medium text-gray-700">ุงููุชุจูู</th>
                                        <th class="px-4 py-3 text-right text-sm font-medium text-gray-700">ูุณุจุฉ ุงูุฅูุฌุงุฒ</th>
                                        <th class="px-4 py-3 text-right text-sm font-medium text-gray-700">ุงูุญุงูุฉ</th>
                                    </tr>
                                </thead>
                                <tbody id="projectPerformanceTable">
                                    <tr>
                                        <td colspan="7" class="px-4 py-8 text-center text-gray-500">
                                            <i class="fas fa-chart-bar text-4xl mb-4 text-gray-300"></i>
                                            <p>ูุง ุชูุฌุฏ ุจูุงูุงุช ูุชุงุญุฉ</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Export options -->
                    <div class="dashboard-card p-6">
                        <h3 class="text-lg font-bold text-gray-900 mb-6">ุชุตุฏูุฑ ุงูุชูุงุฑูุฑ</h3>
                        <div class="flex flex-wrap gap-4">
                            <button onclick="exportToPDF()" class="bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700">
                                <i class="fas fa-file-pdf mr-2"></i>
                                ุชุตุฏูุฑ PDF
                            </button>
                            <button onclick="exportToExcel()" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700">
                                <i class="fas fa-file-excel mr-2"></i>
                                ุชุตุฏูุฑ Excel
                            </button>
                            <button onclick="printReport()" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">
                                <i class="fas fa-print mr-2"></i>
                                ุทุจุงุนุฉ
                            </button>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script src="main.js"></script>
    <script>
        let monthlyChart, expenseChart;

        document.addEventListener('DOMContentLoaded', function() {
            loadProjects();
            initializeCharts();
            generateReport();
            
            // Set default date range (last 30 days)
            const endDate = new Date();
            const startDate = new Date();
            startDate.setDate(startDate.getDate() - 30);
            
            document.getElementById('endDate').value = endDate.toISOString().split('T')[0];
            document.getElementById('startDate').value = startDate.toISOString().split('T')[0];
        });

        function loadProjects() {
            fetch('/api/projects')
                .then(response => response.json())
                .then(data => {
                    const select = document.getElementById('reportProject');
                    data.forEach(project => {
                        const option = document.createElement('option');
                        option.value = project.id;
                        option.textContent = project.name;
                        select.appendChild(option);
                    });
                })
                .catch(error => console.error('Error loading projects:', error));
        }

        function initializeCharts() {
            // Monthly revenue/expense chart
            const monthlyCtx = document.getElementById('monthlyChart').getContext('2d');
            monthlyChart = new Chart(monthlyCtx, {
                type: 'line',
                data: {
                    labels: ['ููุงูุฑ', 'ูุจุฑุงูุฑ', 'ูุงุฑุณ', 'ุฃุจุฑูู', 'ูุงูู', 'ููููู'],
                    datasets: [{
                        label: 'ุงูุฅูุฑุงุฏุงุช',
                        data: [0, 0, 0, 0, 0, 0],
                        borderColor: 'rgb(34, 197, 94)',
                        backgroundColor: 'rgba(34, 197, 94, 0.1)',
                        tension: 0.4
                    }, {
                        label: 'ุงููุตุฑููุงุช',
                        data: [0, 0, 0, 0, 0, 0],
                        borderColor: 'rgb(239, 68, 68)',
                        backgroundColor: 'rgba(239, 68, 68, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            // Expense distribution chart
            const expenseCtx = document.getElementById('expenseChart').getContext('2d');
            expenseChart = new Chart(expenseCtx, {
                type: 'doughnut',
                data: {
                    labels: ['ุฑูุงุชุจ', 'ูุนุฏุงุช', 'ููุงูุน', 'ุชุณููู', 'ุฃุฎุฑู'],
                    datasets: [{
                        data: [0, 0, 0, 0, 0],
                        backgroundColor: [
                            'rgb(239, 68, 68)',
                            'rgb(245, 158, 11)',
                            'rgb(34, 197, 94)',
                            'rgb(59, 130, 246)',
                            'rgb(147, 51, 234)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                        }
                    }
                }
            });
        }

        function generateReport() {
            // Simulate report generation
            updateSummaryCards();
            updateCharts();
            updateProjectPerformance();
        }

        function updateSummaryCards() {
            // Simulate data
            document.getElementById('reportTotalRevenue').textContent = '0 ุฌ.ู';
            document.getElementById('reportTotalExpenses').textContent = '0 ุฌ.ู';
            document.getElementById('reportNetProfit').textContent = '0 ุฌ.ู';
            document.getElementById('reportProjectCount').textContent = '0';
        }

        function updateCharts() {
            // Update monthly chart with sample data
            monthlyChart.data.datasets[0].data = [12000, 15000, 18000, 22000, 25000, 28000];
            monthlyChart.data.datasets[1].data = [8000, 10000, 12000, 15000, 18000, 20000];
            monthlyChart.update();

            // Update expense chart with sample data
            expenseChart.data.datasets[0].data = [40, 25, 15, 10, 10];
            expenseChart.update();
        }

        function updateProjectPerformance() {
            const tbody = document.getElementById('projectPerformanceTable');
            tbody.innerHTML = `
                <tr>
                    <td colspan="7" class="px-4 py-8 text-center text-gray-500">
                        <i class="fas fa-chart-bar text-4xl mb-4 text-gray-300"></i>
                        <p>ูุง ุชูุฌุฏ ูุดุงุฑูุน ูุชุงุญุฉ</p>
                    </td>
                </tr>
            `;
        }

        function exportToPDF() {
            alert('ุณูุชู ุชุตุฏูุฑ ุงูุชูุฑูุฑ ุฅูู PDF');
        }

        function exportToExcel() {
            alert('ุณูุชู ุชุตุฏูุฑ ุงูุชูุฑูุฑ ุฅูู Excel');
        }

        function printReport() {
            window.print();
        }
    </script>
</body>
</html>
                </div>
                <div class="notifications">
                    <button class="notification-btn">๐</button>
                    <span class="notification-count">3</span>
                </div>
                <div class="user-menu">
                    <button class="user-btn" id="user-btn">๐ค</button>
                    <div class="user-dropdown" id="user-dropdown">
                        <div class="user-info">
                            <span id="username-display">admin</span>
                            <small>ุงูุฅุฏุงุฑุฉ</small>
                        </div>
                        <hr>
                        <a href="#" onclick="logout()">ุชุณุฌูู ุงูุฎุฑูุฌ</a>
                    </div>
                </div>
            </div>
            
            <div class="nav-toggle" id="nav-toggle">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </nav>

    <main class="main-content">
        <div class="page-header">
            <h1>ุงูุชูุงุฑูุฑ ุงููุงููุฉ</h1>
            <p>ุชูุงุฑูุฑ ุดุงููุฉ ุนู ุงูุฃุฏุงุก ุงููุงูู ูููุดุงุฑูุน</p>
        </div>

        <div class="content-grid">
            <!-- Report Filters -->
            <div class="card">
                <div class="card-header">
                    <h2>ููุงุชุฑ ุงูุชูุฑูุฑ</h2>
                </div>
                <div class="card-content">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="report-project">ุงููุดุฑูุน</label>
                            <select id="report-project">
                                <option value="">ุฌููุน ุงููุดุงุฑูุน</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="report-period">ุงููุชุฑุฉ ุงูุฒูููุฉ</label>
                            <select id="report-period">
                                <option value="all">ุฌููุน ุงููุชุฑุงุช</option>
                                <option value="today">ุงูููู</option>
                                <option value="week">ูุฐุง ุงูุฃุณุจูุน</option>
                                <option value="month">ูุฐุง ุงูุดูุฑ</option>
                                <option value="quarter">ูุฐุง ุงูุฑุจุน</option>
                                <option value="year">ูุฐุง ุงูุนุงู</option>
                                <option value="custom">ูุชุฑุฉ ูุฎุตุตุฉ</option>
                            </select>
                        </div>
                        
                        <div class="form-group" id="custom-date-range" style="display: none;">
                            <label for="start-date">ูู ุชุงุฑูุฎ</label>
                            <input type="date" id="start-date">
                        </div>
                        
                        <div class="form-group" id="custom-date-range-end" style="display: none;">
                            <label for="end-date">ุฅูู ุชุงุฑูุฎ</label>
                            <input type="date" id="end-date">
                        </div>
                        
                        <div class="form-actions">
                            <button class="btn btn-primary" onclick="generateReport()">ุฅูุดุงุก ุงูุชูุฑูุฑ</button>
                            <button class="btn btn-secondary" onclick="exportReport()">ุชุตุฏูุฑ PDF</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Financial Summary -->
            <div class="card">
                <div class="card-header">
                    <h2>ุงูููุฎุต ุงููุงูู</h2>
                </div>
                <div class="card-content">
                    <div class="summary-grid">
                        <div class="summary-item">
                            <div class="summary-label">ุฅุฌูุงูู ุงูุฅูุฑุงุฏุงุช</div>
                            <div class="summary-value income" id="summary-income">0 ุฌ.ู</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">ุฅุฌูุงูู ุงููุตุฑููุงุช</div>
                            <div class="summary-value expense" id="summary-expenses">0 ุฌ.ู</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">ุตุงูู ุงูุฑุจุญ</div>
                            <div class="summary-value" id="summary-profit">0 ุฌ.ู</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">ูุงูุด ุงูุฑุจุญ</div>
                            <div class="summary-value" id="summary-margin">0%</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Project Performance -->
            <div class="card">
                <div class="card-header">
                    <h2>ุฃุฏุงุก ุงููุดุงุฑูุน</h2>
                </div>
                <div class="card-content">
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>ุงููุดุฑูุน</th>
                                    <th>ุงูููุฒุงููุฉ ุงููุฎุทุทุฉ</th>
                                    <th>ุงููุจูุบ ุงููุตุฑูู</th>
                                    <th>ุงููุชุจูู</th>
                                    <th>ูุณุจุฉ ุงูุฅูุฌุงุฒ</th>
                                    <th>ุงูุญุงูุฉ</th>
                                </tr>
                            </thead>
                            <tbody id="projects-performance">
                                <!-- Project performance data will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Expense Breakdown -->
            <div class="card">
                <div class="card-header">
                    <h2>ุชูุตูู ุงููุตุฑููุงุช</h2>
                </div>
                <div class="card-content">
                    <div class="chart-container">
                        <canvas id="expense-chart" width="400" height="200"></canvas>
                    </div>
                </div>
            </div>

            <!-- Monthly Trends -->
            <div class="card">
                <div class="card-header">
                    <h2>ุงูุงุชุฌุงูุงุช ุงูุดูุฑูุฉ</h2>
                </div>
                <div class="card-content">
                    <div class="chart-container">
                        <canvas id="trends-chart" width="400" height="200"></canvas>
                    </div>
                </div>
            </div>

            <!-- Top Expenses -->
            <div class="card">
                <div class="card-header">
                    <h2>ุฃูุจุฑ ุงููุตุฑููุงุช</h2>
                </div>
                <div class="card-content">
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>ุงููุตู</th>
                                    <th>ุงููุดุฑูุน</th>
                                    <th>ุงููุฆุฉ</th>
                                    <th>ุงููุจูุบ</th>
                                    <th>ุงูุชุงุฑูุฎ</th>
                                </tr>
                            </thead>
                            <tbody id="top-expenses">
                                <!-- Top expenses will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="main.js"></script>
    <script>
        let projects = [];
        let transactions = [];
        let reportData = {};

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            checkAuth();
            loadProjects();
            loadTransactions();
            setupEventListeners();
        });

        function setupEventListeners() {
            document.getElementById('report-period').addEventListener('change', function() {
                const customDateRange = document.getElementById('custom-date-range');
                const customDateRangeEnd = document.getElementById('custom-date-range-end');
                
                if (this.value === 'custom') {
                    customDateRange.style.display = 'block';
                    customDateRangeEnd.style.display = 'block';
                } else {
                    customDateRange.style.display = 'none';
                    customDateRangeEnd.style.display = 'none';
                }
            });
        }

        async function loadProjects() {
            try {
                const response = await fetch('/api/projects');
                if (response.ok) {
                    projects = await response.json();
                    updateProjectSelect();
                }
            } catch (error) {
                console.error('Error loading projects:', error);
            }
        }

        async function loadTransactions() {
            try {
                const response = await fetch('/api/transactions');
                if (response.ok) {
                    transactions = await response.json();
                } else {
                    transactions = [];
                }
                generateReport();
            } catch (error) {
                console.error('Error loading transactions:', error);
                transactions = [];
                generateReport();
            }
        }

        function updateProjectSelect() {
            const select = document.getElementById('report-project');
            
            // Clear existing options except the first one
            while (select.children.length > 1) {
                select.removeChild(select.lastChild);
            }
            
            projects.forEach(project => {
                const option = document.createElement('option');
                option.value = project.id;
                option.textContent = project.name;
                select.appendChild(option);
            });
        }

        function generateReport() {
            const projectId = document.getElementById('report-project').value;
            const period = document.getElementById('report-period').value;
            const startDate = document.getElementById('start-date').value;
            const endDate = document.getElementById('end-date').value;

            // Filter data based on selections
            let filteredTransactions = [...transactions];
            let filteredProjects = [...projects];

            // Filter by project
            if (projectId) {
                filteredTransactions = filteredTransactions.filter(t => t.project_id == projectId);
                filteredProjects = filteredProjects.filter(p => p.id == projectId);
            }

            // Filter by date period
            filteredTransactions = filterByPeriod(filteredTransactions, period, startDate, endDate);

            // Generate report data
            reportData = {
                transactions: filteredTransactions,
                projects: filteredProjects,
                period: period,
                startDate: startDate,
                endDate: endDate
            };

            updateFinancialSummary();
            updateProjectPerformance();
            updateTopExpenses();
            // Note: Chart functionality would require a charting library like Chart.js
        }

        function filterByPeriod(transactions, period, startDate, endDate) {
            const now = new Date();
            let filterStartDate, filterEndDate;

            switch (period) {
                case 'today':
                    filterStartDate = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                    filterEndDate = new Date(now.getFullYear(), now.getMonth(), now.getDate() + 1);
                    break;
                case 'week':
                    const weekStart = new Date(now);
                    weekStart.setDate(now.getDate() - now.getDay());
                    filterStartDate = weekStart;
                    filterEndDate = new Date(weekStart);
                    filterEndDate.setDate(weekStart.getDate() + 7);
                    break;
                case 'month':
                    filterStartDate = new Date(now.getFullYear(), now.getMonth(), 1);
                    filterEndDate = new Date(now.getFullYear(), now.getMonth() + 1, 1);
                    break;
                case 'quarter':
                    const quarter = Math.floor(now.getMonth() / 3);
                    filterStartDate = new Date(now.getFullYear(), quarter * 3, 1);
                    filterEndDate = new Date(now.getFullYear(), (quarter + 1) * 3, 1);
                    break;
                case 'year':
                    filterStartDate = new Date(now.getFullYear(), 0, 1);
                    filterEndDate = new Date(now.getFullYear() + 1, 0, 1);
                    break;
                case 'custom':
                    if (startDate && endDate) {
                        filterStartDate = new Date(startDate);
                        filterEndDate = new Date(endDate);
                        filterEndDate.setDate(filterEndDate.getDate() + 1);
                    } else {
                        return transactions;
                    }
                    break;
                default:
                    return transactions;
            }

            return transactions.filter(t => {
                const transactionDate = new Date(t.date);
                return transactionDate >= filterStartDate && transactionDate < filterEndDate;
            });
        }

        function updateFinancialSummary() {
            const income = reportData.transactions
                .filter(t => t.type === 'income')
                .reduce((sum, t) => sum + parseFloat(t.amount), 0);
            
            const expenses = reportData.transactions
                .filter(t => t.type === 'expense')
                .reduce((sum, t) => sum + parseFloat(t.amount), 0);
            
            const profit = income - expenses;
            const margin = income > 0 ? ((profit / income) * 100).toFixed(1) : 0;

            document.getElementById('summary-income').textContent = formatCurrency(income);
            document.getElementById('summary-expenses').textContent = formatCurrency(expenses);
            document.getElementById('summary-profit').textContent = formatCurrency(profit);
            document.getElementById('summary-profit').className = `summary-value ${profit >= 0 ? 'income' : 'expense'}`;
            document.getElementById('summary-margin').textContent = `${margin}%`;
        }

        function updateProjectPerformance() {
            const tbody = document.getElementById('projects-performance');
            tbody.innerHTML = '';

            if (reportData.projects.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="text-center">ูุง ุชูุฌุฏ ูุดุงุฑูุน</td></tr>';
                return;
            }

            reportData.projects.forEach(project => {
                const projectExpenses = reportData.transactions
                    .filter(t => t.project_id == project.id && t.type === 'expense')
                    .reduce((sum, t) => sum + parseFloat(t.amount), 0);
                
                const remaining = project.total_budget - projectExpenses;
                const progress = project.total_budget > 0 ? ((projectExpenses / project.total_budget) * 100).toFixed(1) : 0;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${project.name}</td>
                    <td>${formatCurrency(project.total_budget)}</td>
                    <td>${formatCurrency(projectExpenses)}</td>
                    <td class="${remaining >= 0 ? 'income' : 'expense'}">${formatCurrency(remaining)}</td>
                    <td>${progress}%</td>
                    <td><span class="status ${project.status}">${getStatusText(project.status)}</span></td>
                `;
                tbody.appendChild(row);
            });
        }

        function updateTopExpenses() {
            const tbody = document.getElementById('top-expenses');
            tbody.innerHTML = '';

            const expenses = reportData.transactions
                .filter(t => t.type === 'expense')
                .sort((a, b) => parseFloat(b.amount) - parseFloat(a.amount))
                .slice(0, 10);

            if (expenses.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="text-center">ูุง ุชูุฌุฏ ูุตุฑููุงุช</td></tr>';
                return;
            }

            expenses.forEach(expense => {
                const project = projects.find(p => p.id == expense.project_id);
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${expense.description}</td>
                    <td>${project ? project.name : 'ุบูุฑ ูุญุฏุฏ'}</td>
                    <td>${expense.category}</td>
                    <td class="expense">${formatCurrency(expense.amount)}</td>
                    <td>${formatDate(expense.date)}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function exportReport() {
            // This would typically generate a PDF report
            // For now, we'll show a notification
            showNotification('ุณูุชู ุฅุถุงูุฉ ููุฒุฉ ุชุตุฏูุฑ PDF ูุฑูุจุงู', 'info');
        }

        function getStatusText(status) {
            const statusMap = {
                'planning': 'ุชุฎุทูุท',
                'in-progress': 'ููุฏ ุงูุชูููุฐ',
                'completed': 'ููุชูู',
                'on-hold': 'ูุชููู'
            };
            return statusMap[status] || status;
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('ar-EG');
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('ar-EG', {
                style: 'currency',
                currency: 'EGP',
                minimumFractionDigits: 0
            }).format(amount);
        }
    </script>
</body>
</html>

